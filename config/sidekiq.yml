## Main Sidekiq process for migration and general jobs
#
# The critical queue is handled by a SEPARATE dedicated process
# (config/sidekiq_critical.yml) to ensure UpdatePlcJob and
# ActivateAccountJob are never blocked by long-running blob transfers.
#
# NOTE: Sidekiq concurrency should be >= MAX_CONCURRENT_BLOB_MIGRATIONS
# (default 30) to avoid blob jobs waiting for a free thread. On a 256GB
# machine, 35 threads leaves room for non-blob jobs alongside 30 blob jobs.

:concurrency: <%= ENV.fetch('SIDEKIQ_CONCURRENCY', 35) %>
:timeout: 30

:queues:
  - [migrations, 2]
  - [default, 1]
  - [low, 1]

:scheduler:
  :schedule:
    cleanup_expired_backups:
      cron: '0 * * * *'  # Every hour at minute 0
      class: CleanupBackupBundleJob
      queue: low
      description: "Clean up expired backup bundles (24h TTL)"

    cleanup_expired_credentials:
      cron: '0 */6 * * *'  # Every 6 hours
      class: CleanupExpiredCredentialsJob
      queue: low
      description: "Purge expired credentials from database (security)"
